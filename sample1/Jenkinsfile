pipeline {
     agent any
     triggers {
          pollSCM('* * * * *')
     }
     stages {
         stage("print branch name") {
            steps {
             echo "I am the ${env.BRANCH_NAME} branch"
            }
          }
          stage("Compile") {
                   if (env.BRANCH_NAME != "main") {
                        steps {
                                sh '''
                                 pwd
                                 chmod + x sample1
                                 cd sample1
                                 pwd
                                 chmod + x gradlew
                                ./gradlew compileJava
                                '''
                        }
                    }else{
                        steps {
                            echo "Compile stage skipped because of main branch current branch ${env.BRANCH_NAME} "
                          } 
                    }
          }
          stage("Unit test") {
                   if (env.BRANCH_NAME != "main") {
                        steps {
                                sh '''
                                 pwd
                                 chmod + x sample1
                                 cd sample1
                                 pwd
                                 chmod + x gradlew
                                ./gradlew test
                                '''
                        }
                   }else{
                    steps {
                        echo "Unit test stage skipped because of main branch current branch ${env.BRANCH_NAME} "
                      } 
                   }
          }
          stage("Code coverage") {
                   if (env.BRANCH_NAME == "main") {
                        steps {
                                sh '''
                                 pwd
                                 chmod + x sample1
                                 cd sample1
                                 pwd
                                 chmod + x gradlew
                                ./gradlew jacocoTestReport
                                '''
                                sh '''
                                 pwd
                                 chmod + x sample1
                                 cd sample1
                                 pwd
                                 chmod + x gradlew
                                ./gradlew jacocoTestCoverageVerification
                                '''
                        }
                    }else{
                            steps {
                                echo "Unit test stage skipped because of main branch current branch ${env.BRANCH_NAME} "
                              } 
                        }
          }
       }
}
